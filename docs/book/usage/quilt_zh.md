# Quilt：Walrus 原生批量存储工具

*Quilt* 是一个批量存储功能，旨在优化大量小 blob 的存储成本和效率。在 *quilt* 之前，在 Walrus 中存储小 blob（小于 10MB）由于内部系统数据开销，导致每字节成本较高。*Quilt* 通过将多个（QuiltV1 最多 666 个）blob 编码到一个名为 quilt 的单元中来解决这个问题，显著减少了 Walrus 存储开销，降低了购买 Walrus/Sui 存储以及 Sui 计算 gas 费用的成本。

重要的是，quilt 中的每个 blob 都可以单独访问和检索，无需下载整个 quilt。此外，quilt 中的 blob 边界与 Walrus 内部结构以及 Walrus 存储节点对齐，这使得检索延迟与常规 blob 相当，甚至更低。

此外，*quilt* 引入了自定义的、不可变的 `Walrus 原生` blob 元数据，允许用户为 quilt 中的每个 blob 分配不同类型的`元数据`，例如唯一标识符以及键值对标签。请注意，此元数据在功能上类似于现有的链上 Blob 元数据存储，但存在一些根本区别。首先，`Walrus 原生`元数据与 blob 数据一起存储，因此降低了成本并简化了管理。其次，此元数据可用于高效查找 quilt 中的 blob，例如，读取具有特定标签的 blob。在存储 quilt 时，用户可以通过 *quilt* API 设置`Walrus 原生`元数据。

```admonish warning
标识符必须以字母数字字符开头，不包含尾随空白字符，且长度不得超过 64 KB。

所有标签的总大小不得超过 64 KB。
```

## 重要考虑事项

需要注意的是，存储在 quilt 中的 blob 被分配了一个唯一的 ID，称为 `QuiltPatchId`，这与用于常规 Walrus blob 的 `BlobId` 不同，`QuiltPatchId` 由整个 quilt 的组成决定，而不是单个 blob，因此如果 blob 存储在不同的 quilt 中，它可能会发生变化。此外，单个 blob 不能被单独删除、扩展或共享；这些操作只能应用于整个 quilt。

## 目标用例

使用 *quilt* 除了标准程序外只需要最少的额外工作。主要考虑是分配给 quilt 中每个 blob 的唯一 ID 不能直接从其内容派生（与常规 Walrus blob_id 不同），删除、扩展和共享操作不允许对 quilt 中的单个 blob 执行，只有 quilt 可以成为目标。

### 降低成本

这是最明显和重要的用例。*Quilt* 对于管理大量小 blob 特别有利，只要用户可以将它们分组在一起。成本节约来自两个方面：

- **Walrus 存储和写入费用**：通过将多个小 blob 合并到单个 quilt 中，存储成本可以大幅降低——对于约 10KB 的文件，成本可降低 400 多倍——这为成本敏感的应用程序提供了高效的解决方案。

- **Sui 计算和对象存储费用**：将许多 blob 存储为单个 quilt 显著降低了 Sui gas 成本。在我们的测试运行中，将 600 个文件存储在 quilt 中，与将它们存储为单个 blob 相比，我们观察到 Sui 费用节省了 **238 倍**。值得注意的是，Sui 成本节约只取决于每个 quilt 的文件数量，而不是单个文件大小。

下表展示了将 600 个小 blob 存储 1 个 epoch 作为 quilt 与将它们存储为单独 blob 相比，WAL 中的潜在成本节约。

| Blob 大小 | 常规 blob 存储成本 | Quilt 存储成本 | 成本节约倍数 |
|----------:|--------------------------:|-------------------:|-------------------:|
|      10KB |                 2.088 WAL |          0.005 WAL |               409x |
|      50KB |                 2.088 WAL |          0.011 WAL |               190x |
|     100KB |                 2.088 WAL |          0.020 WAL |               104x |
|     200KB |                 2.088 WAL |          0.036 WAL |                58x |
|     500KB |                 2.136 WAL |          0.084 WAL |                25x |
|       1MB |                 2.208 WAL |          0.170 WAL |                13x |

> **注意：** 此表中显示的成本仅供说明，是从 Walrus 测试网的测试运行中获得的。由于智能合约参数、网络和其他因素的变化，实际成本可能有所不同。比较是将 600 个文件存储为单个 quilt 与将它们以 25 个为一批存储为单个 blob 之间的比较。

### 组织集合

*Quilt* 提供了一种直接的方式来组织和管理单个单元内的小 blob 集合。这可以简化数据处理，并在处理相关小文件（如 NFT 图像集合）时提高操作效率。

### Walrus 原生 blob 元数据

*Quilt* 支持直接存储在 Walrus 中的不可变自定义元数据，包括标识符和标签。这些功能有助于更好的组织，支持灵活的查找，并协助管理每个 quilt 中的 blob，增强检索和管理过程。

有关如何使用 CLI 与 *quilt* 交互的详细信息，请参阅[使用 quilt 批量存储 blob](./client-cli_zh.md#batch-storing-blobs-with-quilt) 部分。