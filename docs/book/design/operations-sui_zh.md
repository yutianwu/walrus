# Sui 上的操作

Walrus 使用 Sui 智能合约来协调具有生命周期的存储操作作为资源和支付。智能合约还促进治理以确定持有每个存储分片的存储节点。以下内容概述了这些操作并将它们作为读/写路径的一部分引用。

元数据是唯一暴露给 Sui 或其验证器的 blob 元素，因为 blobs 的内容总是离链存储在 Walrus 存储节点和缓存上。存储节点或缓存不必与任何 Sui 基础设施组件（如验证器）重叠，存储纪元可以有不同的长度，并且不必与 Sui 纪元有相同的开始/结束时间。

## Sui 上的存储资源生命周期

许多 Sui 智能合约持有 Walrus 系统及其所有实体的元数据。

- **Walrus 系统对象**持有当前存储纪元的存储节点委员会。系统对象还持有 Walrus 上的总可用空间和每单位存储（1 KiB）的价格。

  这些值由存储纪元的存储节点之间的 2/3 协议确定。用户可以付费购买一些时间持续时间的存储空间。这些空间资源可以分割、合并和转移。稍后，它们可以用于将 blob ID 放入 Walrus。

- **存储基金**持有在一个或多个存储纪元上存储 blobs 的资金。当从系统对象购买存储空间时，用户向在多个存储纪元上分离的存储基金付款。根据性能每个纪元向存储节点付款（详细信息如下）。

- 用户通过合约或转移获取一些存储，并可以为其分配 blob ID，表示他们想要将此 blob ID 存储到其中。这发出存储节点监听的 Move **资源事件**，以期望和授权链下存储操作。

- 最终，用户持有来自存储节点的 blob ID 的链下**可用性证书**。用户**在链上上传证书**以信号 blob ID 在可用期内可用。证书根据最新的 Walrus 委员会进行检查，如果正确，为 blob ID 发出**可用性事件**。这是 blob 的可用性点。

- 稍后，认证 blob 的存储可以通过添加具有更长到期期间的存储对象来**延长**。只要存在资金继续提供存储，智能合约就可以使用此功能来延长永久存储的 blobs 的可用性。

- 如果 blob ID 编码不正确，可以稍后在链上上传**不一致性证明证书**。此操作发出**不一致 blob 事件**，表示 blob ID 读取结果总是返回 `None`。这表明其 slivers 可以被存储节点删除，除了返回 `None` 的指示器。

写入 Walrus 的用户需要执行 Sui 交易以获取存储和认证 blobs。创建或消费 blob 可用性证明的用户仅读取链以证明或验证事件的发出。节点每个纪元只读取区块链一次以获取委员会元数据，然后通过 blob ID 直接从存储节点请求 slivers 以在 Walrus 资源上执行读取。

## Sui 上的治理操作

每个 Walrus 存储纪元由包含存储委员会和存储节点的各种元数据或存储节点（如分片和存储节点之间的映射、可用空间和当前成本）的 Walrus 系统对象表示。

用户可以转到该期间的系统对象并**购买一些存储**量用于一个或多个存储纪元。在每个存储纪元都有存储价格，提供的付款成为跨越所购买存储的所有存储纪元的**存储基金**的一部分。可以购买存储的未来存储纪元的最大数量（大约 2 年）。存储是可以分割、合并和转移的资源。

在存储纪元结束时，**存储基金中的部分资金需要分配给存储节点**。这里的想法是让存储节点彼此执行轻审计，并基于这些审计的性能建议支付哪些节点。